<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RodrigoRPmods Web</title>

  <style>
    :root{
      --bg:#0a0a0a;
      --bg2:#111111;
      --accent:#ff7a1a;       /* naranja oscuro principal */
      --accent-2:#c75a12;     /* naranja m√°s oscuro para hover/bordes */
      --muted:#bfbfbf;
      --text:#eeeeee;
      --card:#151515;
      --card-2:#1b1b1b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --grad: radial-gradient(1200px 700px at 0% -10%, rgba(255,122,26,.15), transparent 60%),
              radial-gradient(1000px 600px at 100% 110%, rgba(255,122,26,.10), transparent 60%),
              linear-gradient(180deg, #0b0b0b, #0a0a0a 35%, #0a0a0a);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background: var(--grad), #000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      line-height:1.4;
    }
    a{text-decoration:none;color:inherit}
    button{font:inherit}

    header{
      position:sticky; top:0; z-index:20;
      background: linear-gradient(90deg, rgba(255,122,26,.12), rgba(255,122,26,.02));
      border-bottom:1px solid rgba(255,255,255,.06);
      padding:14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      backdrop-filter: blur(6px);
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px;}
    .brand .dot{width:10px; height:10px; border-radius:99px; background:var(--accent); box-shadow:0 0 20px rgba(255,122,26,.55);}
    .title{font-size:1.05rem}
    .tabs{display:flex; gap:8px; align-items:center; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06); padding:4px; border-radius:12px;}
    .tab{padding:8px 12px; border-radius:10px; cursor:pointer; user-select:none; transition: all .18s ease; color:#ddd;}
    .tab.active{
      background: linear-gradient(180deg, rgba(255,122,26,.22), rgba(255,122,26,.14));
      color:#fff; border:1px solid rgba(255,122,26,.45);
      box-shadow: inset 0 0 0 1px rgba(255,122,26,.15), 0 3px 10px rgba(0,0,0,.25);
    }
    .tab:hover{transform: translateY(-1px);}

    .container{max-width:1200px; margin:18px auto; padding:0 16px; display:grid; grid-template-columns: 300px 1fr; gap:18px;}
    @media (max-width: 980px){ .container{grid-template-columns:1fr} }

    .sidebar{
      background: linear-gradient(180deg, var(--card), var(--card-2));
      border:1px solid rgba(255,255,255,.06);
      border-radius:14px; box-shadow: var(--shadow); overflow:hidden;
    }
    .side-head{
      padding:12px 14px; background:linear-gradient(90deg, rgba(255,122,26,.14), transparent);
      border-bottom:1px solid rgba(255,255,255,.06); display:flex; flex-direction:column; gap:10px;
    }
    .side-head-top{display:flex; justify-content:space-between; align-items:center; gap:6px}
    .side-head .pill{font-size:.8rem; color:#222; background:var(--accent); padding:3px 8px; border-radius:999px; border:1px solid rgba(0,0,0,.15)}

    /* Buscador unificado */
    .search{position:relative; display:flex; align-items:center;}
    .search input{
      width:100%; padding:10px 34px 10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.05); color:#fff; outline:none;
    }
    .search .icon{
      position:absolute; right:10px; width:18px; height:18px; opacity:.8; pointer-events:none;
      background: radial-gradient(circle, rgba(255,255,255,.9) 40%, rgba(255,255,255,.0) 41%);
      -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.5-1.5-5-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>') center/contain no-repeat;
              mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.5-1.5-5-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>') center/contain no-repeat;
    }

    .side-section{padding:10px 10px 14px; border-top:1px dashed rgba(255,255,255,.06);}
    .side-section:first-of-type{border-top:none}
    .side-section h4{margin:10px 6px 8px; font-size:.94rem; color:#ffddc2; letter-spacing:.2px; display:flex; align-items:center; gap:8px; font-weight:700;}
    .side-list{display:flex; flex-direction:column; gap:10px; padding:0 4px}

    .side-item{
      padding:10px; border-radius:12px; background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
      cursor:pointer; transition:all .15s ease; display:flex; gap:10px; align-items:center;
    }
    .side-item:hover{transform:translateX(2px); background:rgba(255,122,26,.10)}
    .side-item.active{
      background: linear-gradient(180deg, rgba(255,122,26,.24), rgba(255,122,26,.12));
      border-color: rgba(255,122,26,.45);
      box-shadow: inset 0 0 0 1px rgba(255,122,26,.12);
    }
    .side-thumb{
      width:44px; height:44px; border-radius:8px; flex:0 0 44px; background:#222 center/cover no-repeat;
      border:1px solid rgba(255,255,255,.08);
    }
    .side-info{display:flex; flex-direction:column; gap:2px}
    .side-title{font-weight:700;}
    .side-sub{opacity:.75; font-size:.82rem}

    .panel{
      background: linear-gradient(180deg, var(--card), var(--card-2));
      border:1px solid rgba(255,255,255,.06); border-radius:14px; box-shadow: var(--shadow); overflow:hidden;
    }
    .panel-head{
      padding:14px 16px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.06);
      background:linear-gradient(90deg, rgba(255,122,26,.08), transparent);
    }
    .crumbs{font-size:.92rem; color:#ffdbc1}
    .badges{display:flex; gap:8px; flex-wrap:wrap}
    .badge{font-size:.78rem; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);}
    .badge.primary{ background:rgba(255,122,26,.20); border-color:rgba(255,122,26,.45); color:#ffe4cf; }

    .desc{padding:12px 16px; font-size:.95rem; color:#d8d8d8; border-bottom:1px dashed rgba(255,255,255,.06);}
    .desc .link-season{
      display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); margin-left:8px; cursor:pointer;
    }
    .desc .link-season:hover{background:rgba(255,122,26,.16); border-color:rgba(255,255,255,.35)}

    .grid{display:grid; gap:14px; padding:14px 14px 18px; grid-template-columns: 1.1fr .9fr;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .chapters{background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:12px; overflow:hidden;}
    .chap-head{padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:6px; background:linear-gradient(90deg, rgba(255,122,26,.12), transparent); border-bottom:1px solid rgba(255,255,255,.06);}
    .chap-list{display:flex; flex-direction:column}
    .chap-item{display:flex; justify-content:space-between; align-items:center; gap:10px; padding:12px 14px; border-top:1px solid rgba(255,255,255,.06); background:transparent; cursor:pointer;}
    .chap-item:hover{background:rgba(255,122,26,.06)}
    .chap-item.active{background:rgba(255,122,26,.14)}
    .tag{font-size:.75rem; padding:2px 6px; border-radius:6px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);}

    .players{background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:10px; min-height:320px;}
    .player-buttons{display:flex; flex-wrap:wrap; gap:8px;}
    .btn{border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.06); color:#fff; padding:9px 12px; border-radius:10px; cursor:pointer; transition:.15s ease all; font-size:.92rem;}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background: linear-gradient(180deg, rgba(255,122,26,.28), rgba(255,122,26,.16)); border-color: rgba(255,122,26,.45);}
    .btn.disabled{background:rgba(255,255,255,.04)!important; border-color:rgba(255,255,255,.06)!important; color:#999!important; cursor:not-allowed!important; filter:grayscale(.6); box-shadow:none!important; transform:none!important;}
    .viewer{margin-top:8px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,.08); background:#000; aspect-ratio:16/9; display:flex; align-items:center; justify-content:center; color:#999; font-size:.92rem; position:relative;}
    .viewer iframe{width:100%; height:100%; border:0}

    /* Placeholder de portada dentro del visor */
    .cover-ph{
      position:absolute; inset:0;
      background:#000 center/cover no-repeat;
      opacity:0; animation: fadeIn .25s ease forwards;
    }
    .cover-hint{
      position:absolute; bottom:10px; right:10px;
      background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.15);
      padding:6px 8px; border-radius:8px; font-size:.85rem; color:#eee;
      opacity:0; animation: fadeIn .25s ease .1s forwards;
    }
    @keyframes fadeIn{ to{opacity:1} }

    .extras{margin:16px 14px 18px; padding:14px; border:1px solid rgba(255,255,255,.06); border-radius:12px; background:rgba(255,255,255,.03);}
    .extras h4{margin:0 0 10px 0}

    /* Mini reproductor MP3 (√∫nico) */
    .audio-box{
      display:flex; flex-direction:column; gap:8px; margin-bottom:12px; padding:12px;
      border-radius:10px; background:linear-gradient(180deg, #121212, #0f0f0f); border:1px solid rgba(255,255,255,.08);
    }
    .audio-title{font-weight:700}
    audio{width:100%}

    /* Playlist con imagen */
    .playlist-box{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap:12px;
      margin-bottom:12px; padding:12px;
      border-radius:12px; background:linear-gradient(180deg, #121212, #0f0f0f); border:1px solid rgba(255,255,255,.08);
    }
    @media (max-width:700px){ .playlist-box{grid-template-columns:1fr} }
    .playlist-cover{
      width:100%; aspect-ratio:1/1; border-radius:10px; background:#222 center/cover no-repeat;
      border:1px solid rgba(255,255,255,.08);
    }
    .playlist-body{display:flex; flex-direction:column; gap:8px}
    .playlist-title{font-weight:800}
    .track-list{display:flex; flex-direction:column; gap:6px; max-height:180px; overflow:auto;}
    .track-item{
      display:flex; justify-content:space-between; gap:8px; align-items:center;
      padding:8px 10px; border-radius:8px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
      cursor:pointer;
    }
    .track-item:hover{background:rgba(255,122,26,.10)}
    .track-item.active{background:rgba(255,122,26,.20); border-color:rgba(255,255,255,.35)}
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    .controls .btn{padding:7px 10px; font-size:.88rem}

    .extra-grid{display:grid; gap:10px; grid-template-columns: repeat(3, 1fr);}
    @media (max-width: 700px){ .extra-grid{grid-template-columns:1fr} }
    .extra-card{background:linear-gradient(180deg, #121212, #0f0f0f); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px;}
    .extra-card .title{font-weight:700}
    .extra-card .mini{font-size:.85rem; color:#d0d0d0}
    .extra-card .btn{width:100%; text-align:center}

    .placeholder{padding:18px; font-size:1rem; color:#d0d0d0;}
    .note{margin:10px 16px 0; padding:10px 12px; border-radius:10px; background:rgba(25,25,25,.6); border:1px dashed rgba(255,255,255,.10); color:#e9e9e9; font-size:.92rem;}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="dot"></div>
      <div class="title">RodrigoRPmods Web</div>
    </div>
    <nav class="tabs" role="tablist" aria-label="Secciones">
      <div class="tab active" role="tab" aria-selected="true" data-tab="animes">Animes</div>
      <div class="tab" role="tab" aria-selected="false" data-tab="juegos">Juegos</div>
    </nav>
  </header>

  <main id="content">
    <!-- ANIMES -->
    <section id="tab-animes" class="container" aria-labelledby="Animes">
      <!-- Sidebar -->
      <aside class="sidebar" aria-label="Cat√°logo de animes">
        <div class="side-head">
          <div class="side-head-top">
            <strong>Categor√≠as</strong>
            <span class="pill">Anime BD RPmods / Anime</span>
          </div>

          <!-- Buscador unificado -->
          <div class="search" style="margin-top:8px;">
            <input id="search-all" type="text" placeholder="Buscar en todas las categor√≠as..." />
            <div class="icon"></div>
          </div>
        </div>

        <div class="side-section">
          <h4>Anime BD RPmods <span class="tag">Principal</span></h4>
          <div class="side-list" id="list-bd"></div>
        </div>

        <div class="side-section">
          <h4>Anime <span class="tag">Secundario</span></h4>
          <div class="side-list" id="list-tv"></div>
        </div>
      </aside>

      <!-- Panel principal -->
      <section class="panel" aria-live="polite">
        <div class="panel-head">
          <div class="crumbs" id="breadcrumbs">Selecciona un t√≠tulo en el lado izquierdo</div>
          <div class="badges" id="badges">
            <span class="badge">Audio: ‚Äî</span>
            <span class="badge">Subt√≠tulos: ‚Äî</span>
            <span class="badge">OP/ED: ‚Äî</span>
            <span class="badge">Karaoke: ‚Äî</span>
            <span class="badge primary">Calidad: ‚Äî</span>
          </div>
        </div>

        <!-- Contadores por serie -->
        <div id="series-stats" 
             style="display:flex; gap:12px; align-items:center; 
                    padding:10px 16px; border-bottom:1px dashed rgba(255,255,255,.06)">
          <!-- Visitas -->
          <span style="display:inline-flex; gap:6px; align-items:center; opacity:.9">
            üëÅÔ∏è <strong id="views-count">‚Äî</strong> vistas
          </span>

          <!-- Likes -->
          <button id="like-btn" class="btn" type="button" title="Me gusta">
            üëç <span id="likes-count">‚Äî</span>
          </button>

          <!-- Mensaje de estado (errores / guardado local) -->
          <span id="like-hint" style="font-size:.85rem; opacity:.8;"></span>
        </div>

        <div class="desc" id="category-note"></div>

        <div class="grid">
          <div class="chapters">
            <div class="chap-head">
              <strong id="chapters-title">Cap√≠tulos</strong>
              <span class="tag">elige uno</span>
            </div>
            <div class="chap-list" id="chapters-list"></div>
          </div>

          <div class="players">
            <div class="player-buttons" id="player-buttons"></div>
            <div class="viewer" id="viewer"><!-- portada placeholder --></div>
          </div>
        </div>

        <!-- Extras -->
        <div class="extras">
          <h4>Contenido extra</h4>

          <!-- Mini reproductor MP3 (√∫nico) opcional -->
          <div class="audio-box" id="audio-box" style="display:none">
            <div class="audio-title" id="audio-title">Banda sonora exclusiva</div>
            <audio id="audio-player" controls preload="none">
              <source id="audio-src" src="" type="audio/mpeg">
              Tu navegador no soporta audio HTML5.
            </audio>
            <div class="mini" style="opacity:.8">Puedes usar un <strong>link</strong> (mp3/stream) o una <strong>ruta local</strong>.</div>
          </div>

          <!-- Playlist con imagen (visible SIEMPRE en BD RPmods) -->
          <div class="playlist-box" id="playlist-box" style="display:none">
            <div class="playlist-cover" id="playlist-cover"></div>
            <div class="playlist-body">
              <div class="playlist-title" id="playlist-title">Playlist</div>
              <div class="controls">
                <button class="btn" id="btn-prev">‚ü® Anterior</button>
                <button class="btn" id="btn-play">‚ñ∂ Reproducir</button>
                <button class="btn" id="btn-next">Siguiente ‚ü©</button>
              </div>
              <div class="track-list" id="track-list"></div>
              <audio id="playlist-audio" preload="none"></audio>
            </div>
          </div>

          <div class="extra-grid" id="extras-grid"></div>
        </div>

        <div class="note">
          Tip: Cualquier bot√≥n sin enlace aparecer√° en <strong>gris</strong>. Edita enlaces e info en el objeto <code>DATA</code>.
        </div>
      </section>
    </section>

    <!-- JUEGOS -->
    <section id="tab-juegos" class="container" style="display:none" aria-labelledby="Juegos">
      <section class="panel" style="grid-column:1/-1">
        <div class="panel-head">
          <div class="crumbs">Juegos</div>
          <div class="badges"><span class="badge">Pr√≥ximamente</span></div>
        </div>
        <div class="placeholder">
          Esta secci√≥n est√° preparada para tus juegos. Puedes reutilizar el estilo de <em>Animes</em>.
        </div>
      </section>
    </section>
  </main>

  <script>
    /* ===========================
       DATASET EDITABLE
       =========================== */
    const DATA = {
      bd: {
        "Las Quintillizas (Temporada 1)": {
          cover: "portada/portadas1gnh.jpg",
          season2Key: "Las Quintillizas (Temporada 2)",
          openingUrl: "",   // Opening propio
          endingUrl: "",    // Ending propio
          info: {
            audio: "Japon√©s",
            subs: "Espa√±ol (SUB)",
            oped: "Clean Version",
            karaoke: "S√≠",
            quality: "1080p (BD RPmods)",
            note: "Edici√≥n Blu-ray con mejoras de imagen, audio y extras exclusivos."
          },
          chapters: [
            { id:"gtn-t1-c01-02", title:"Cap√≠tulo 01 y 02", info:"BD RPmods ‚Äî 1080p",
              players:{ player1:"https://rodrigorpmods.rpmlive.online/#assgjc", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/go-toubun-no-hanayome-cap%C3%ADtulo-1-y-cap%C3%ADtulo-2-sub-espa%C3%B1ol-fanedit-especial-de-lo/2681562718873374/", fb720:"https://video-bog2-2.xx.fbcdn.net/o1/v/t2/f2/m366/AQNtDHYIK0FHQfrjNhvQiOEtAmjPmq-Xiercrt0lGeINB-QYUFRg99VU50FGEuSWv7vRdrR_-U48K7UjNeCc4PLY9ssz2s7jyx-ow0ld9gQJXw.mp4?_nc_cat=108&_nc_sid=5e9851&_nc_ht=video-bog2-2.xx.fbcdn.net&_nc_ohc=yo9tAweFKw8Q7kNvwHzQk0y&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjoxNzYxNTc1NjQ0NTU4ODY0LCJhc3NldF9hZ2VfZGF5cyI6NSwidmlfdXNlY2FzZV9pZCI6MTAxMjIsImR1cmF0aW9uX3MiOjI2NjUsInVybGdlbl9zb3VyY2UiOiJ3d3cifQ%3D%3D&ccb=17-1&vs=ddb54b5ecf51517a&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC82OTQ2MEU1NDdDMDM2MEVFQ0Q5MzkyMEE5RDU1NDA5QV9tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhFZmJfZXBoZW1lcmFsLzdBNEE5RkIyRjdBMDRDMTVGREI0OURGMjc0MEI4MEJEX210XzBfYXVkaW9fZGFzaGluaXQubXA0FQICyAESACgAGAAbAogHdXNlX29pbAExEnByb2dyZXNzaXZlX3JlY2lwZQExFQAAJqDYz6iZiaEGFQIoAkMzLBdApNKUeuFHrhgZZGFzaF9oMjY0LWJhc2ljLWdlbjJfNzIwcBEAdQJllJ4BAA&_nc_gid=1JoCzSit2BDkOc8D9IH4aQ&_nc_zt=28&oh=00_AfiCJdi0bfKdbiNNni6K4cTeT-es19h1I-trWnrKZP_How&oe=690F1798&bitrate=731515&tag=dash_h264-basic-gen2_720p", player3:"https://www.burstcloud.co/embed/e26685e0e94c3f13648e0fa29968af01af467c43f2e8cfe1e15f15905fbfddeb/GNH_CAP01RPMODS.mp4" } },
            { id:"gtn-t1-c03-04", title:"Cap√≠tulo 03 y 04", info:"BD RPmods ‚Äî 1080p",
              players:{ player1:"https://rodrigorpmods.rpmlive.online/#qyy5ic", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/go-toubun-no-hanayome-cap%C3%ADtulo-3-y-cap%C3%ADtulo-4-sub-espa%C3%B1ol-fanedit-especial-de-lo/4348404222151302/", fb720:"https://video-bog2-1.xx.fbcdn.net/o1/v/t2/f2/m366/AQOfrVQaBBOmdVv4qfF8NQjDCoQ9z5a_e3XFDEm4D5Vs9Y60oIBQ1YdDQjhvO1OWi3PlM7UxMDppgfLVAhg0_UxItBEyhH-t9112qcNrNmuqHA.mp4?_nc_cat=102&_nc_sid=5e9851&_nc_ht=video-bog2-1.xx.fbcdn.net&_nc_ohc=VGKDI7XHHZMQ7kNvwGPUd7J&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjo3OTU2OTY4MTMyMjQxOTAsImFzc2V0X2FnZV9kYXlzIjozLCJ2aV91c2VjYXNlX2lkIjoxMDEyMiwiZHVyYXRpb25fcyI6MjY3OSwidXJsZ2VuX3NvdXJjZSI6Ind3dyJ9&ccb=17-1&vs=657c10b609d55c2b&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC8wRTQzRjU1OEQ3ODExM0FBRTY3NEFGQTVBOTlFRTE5MV9tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhFZmJfZXBoZW1lcmFsL0I2NDEyRjE4ODM0OTQ5MkY2Q0U1REY0NTAxMjA4RkE0X210XzBfYXVkaW9fZGFzaGluaXQubXA0FQICyAESACgAGAAbAogHdXNlX29pbAExEnByb2dyZXNzaXZlX3JlY2lwZQExFQAAJvzDtZ7T6-kCFQIoAkMzLBdApO6GJN0vGxgZZGFzaF9oMjY0LWJhc2ljLWdlbjJfNzIwcBEAdQJllJ4BAA&_nc_gid=hGcFwndkV3PO6KH6vsFvRA&_nc_zt=28&oh=00_Afga6If1nE0E5fWDtgEv-T7HDVADMzOPewXAfDpE9oMbdg&oe=690F2FEE&bitrate=731839&tag=dash_h264-basic-gen2_720p", player3:"" } },
            { id:"gtn-t1-prox1", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 05 y 06", info:"Esperando estreno", status:"Pr√≥ximo",
              players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } }
          ],
          extrasAudio: { title: "OST ‚Äî Quintillizas", url: "" },
          extras: [
            { id:"gtn-extra-1", title:"Extra 01 ‚Äî Entrevista Seiyuu", url:"" },
            { id:"gtn-extra-2", title:"Extra 02 ‚Äî Clean OP (BD)", url:"" },
            { id:"gtn-extra-3", title:"Extra 03 ‚Äî Clean ED (BD)", url:"" }
          ],
          extrasPlaylist: { cover:"extra/cover_quintillizas_t1.jpg", title:"Playlist ‚Äî Quintillizas T1", tracks: [] }
        },
        "Las Quintillizas (Temporada 2)": {
          cover: "",
          season2Key: null,
          openingUrl: "",
          endingUrl: "",
          info: {
            audio: "Japon√©s",
            subs: "Espa√±ol (SUB)",
            oped: "Clean Version",
            karaoke: "S√≠",
            quality: "1080p (BD RPmods)",
            note: "Temporada 2 en edici√≥n Blu-ray con a√±adidos."
          },
          chapters: [
            { id:"gtn-t2-prox0", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 01 y 02", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
            { id:"gtn-t2-prox1", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 03 y 04", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
            { id:"gtn-t2-prox2", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 05 y 06", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
			      { id:"gtn-t2-prox3", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 07 y 08", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } }
          ],
          extrasAudio: { title: "OST ‚Äî Quintillizas T2", url: "" },
          extras: [
            { id:"gtn2-extra-1", title:"Extra 01 ‚Äî PV T2", url:"" },
            { id:"gtn2-extra-2", title:"Extra 02 ‚Äî Clean OP (BD)", url:"" },
            { id:"gtn2-extra-3", title:"Extra 03 ‚Äî Clean ED (BD)", url:"" }
          ],
          extrasPlaylist: { cover:"extra/cover_quintillizas_t2.jpg", title:"Playlist ‚Äî Quintillizas T2", tracks: [] }
        },
        "KonoSuba (Temporada 1)": {
          cover: "portada/portadas1fk.png",
          season2Key: "KonoSuba (Temporada 2)",
          openingUrl: "https://www.burstcloud.co/embed/67a4691f55a6d1fe64dc1e1b6f67ba290af75cf63c59a84a2d02de0e7cbecefe/Opening.mp4",  // ejemplo
          endingUrl: "https://www.burstcloud.co/embed/1c16c761c9fbc8d957132e51116d96aea716a255ece139a88225d5f95a6a0cd9/Edning%20%20Full%20Version.mp4",
          info: {
            audio: "Latino",
            subs: "Espa√±ol (textos)",
            oped: "Clean Version",
            karaoke: "S√≠",
            quality: "1080p (BD RPmods)",
            note: "Edici√≥n Blu-ray con timing de karaoke y filtros de imagen."
          },
          chapters: [
            { id:"ksb-t1-c01-02", title:"Cap√≠tulo 01 y 02", info:"BD RPmods ‚Äî 1080p", players:{ player1:"https://rodrigorpmods.rpmlive.online/#8kqexi", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/konosuba-temporada-1-cap%C3%ADtulo-1-cap%C3%ADtulo-2-latino-fanedit-especial-de-los-capitu/1884398822168757/", fb720:"https://video-bog2-2.xx.fbcdn.net/o1/v/t2/f2/m366/AQPI-A_BduNVAienQtoXDugFPfmNT9pL2FTDAaAwsmhJeof6SGn3FcOwYc4RrkVTovbYlgWzQyjXDuv-jcpeH2NfmbzQ7d7iYyk2G7XoPdOlNA.mp4?_nc_cat=107&_nc_sid=5e9851&_nc_ht=video-bog2-2.xx.fbcdn.net&_nc_ohc=t5tPUj3JNhkQ7kNvwFtO_9h&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjoxNDMxMDY1NjUyMDYzNjY5LCJhc3NldF9hZ2VfZGF5cyI6NSwidmlfdXNlY2FzZV9pZCI6MTAxMjIsImR1cmF0aW9uX3MiOjI3NDQsInVybGdlbl9zb3VyY2UiOiJ3d3cifQ%3D%3D&ccb=17-1&vs=f0a223f7a8eb769b&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC8xMDRGOUVEMDVBNzkwN0NCRjBCMzBBOTM1Njg2RTM5MV9tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhAZmJfcGVybWFuZW50LzVDNDIyNkVDQTAxQTI5QkU3RjgxMURGQTJGRTMwQjgwX2F1ZGlvX2Rhc2hpbml0Lm1wNBUCAsgBEgAoABgAGwKIB3VzZV9vaWwBMRJwcm9ncmVzc2l2ZV9yZWNpcGUBMRUAACbqtrv9_eKKBRUCKAJDMywXQKVxZ--dsi0YGWRhc2hfaDI2NC1iYXNpYy1nZW4yXzcyMHARAHUCZZSeAQA&_nc_gid=-GQBbmjWPNaY260eRIuzYw&_nc_zt=28&oh=00_AfgpPxzn19bgQThal69riImkBcba2X3FkbhrcWPYwrCcFw&oe=6915C5BD&bitrate=783701&tag=dash_h264-basic-gen2_720p", player3:"" } },
            { id:"ksb-t1-c03-04", title:"Cap√≠tulo 03 y 04", info:"BD RPmods ‚Äî 1080p", players:{ player1:"https://rodrigorpmods.rpmlive.online/#61wy1p", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/konosuba-temporada-1-cap%C3%ADtulo-3-cap%C3%ADtulo-4-latino-fanedit-especial-de-los-capitu/851903880856450/", fb720:"https://video.xx.fbcdn.net/o1/v/t2/f2/m366/AQOYu1SlPpa5UnqjQYbRVzxbV_tXUGgf60DJlfdOIBUR-2DvtVjXqul1jDizUFrwRauaC31Ezq43cppBtuKtc6pUO0f0VBHQXgpXDL4BRdh5gg.mp4?_nc_cat=106&_nc_oc=AdmkimMzp6jYzdd5-HYmgmEimPqp-jwLXHuweh-4wzw18kDGWg0Lk-RqOst-7xu-dTU&_nc_sid=5e9851&_nc_ht=video.fhan5-8.fna.fbcdn.net&_nc_ohc=EoFj0Y_BXl8Q7kNvwEbvS3F&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjoxNTgxNDU2ODkzMjMwNjIzLCJhc3NldF9hZ2VfZGF5cyI6MCwidmlfdXNlY2FzZV9pZCI6MTAxMjIsImR1cmF0aW9uX3MiOjI2NTEsInVybGdlbl9zb3VyY2UiOiJ3d3cifQ%3D%3D&ccb=17-1&vs=f41205831102d631&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC9CRTQzNjc2ODFFNDg4NTg1RkY1QTU0QjUxNjU4RkY4NF9tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhFZmJfZXBoZW1lcmFsLzM0NDUyMEY3NDNDRDRENjc0OEJEM0ZFRDUzMDk5QUEzX210XzBfYXVkaW9fZGFzaGluaXQubXA0FQICyAESACgAGAAbAogHdXNlX29pbAExEnByb2dyZXNzaXZlX3JlY2lwZQExFQAAJr74yYX0lM8FFQIoAkMzLBdApLaiTdLxqhgZZGFzaF9oMjY0LWJhc2ljLWdlbjJfNzIwcBEAdQJllJ4BAA&_nc_gid=1GwY1vLqCD0c9HjdN5CXwA&edm=AGo2L-IEAAAA&_nc_zt=28&oh=00_Afg4JaqA3mLwktXNsENHRMSUUI52K_-k-BwkMPycE7GM1g&oe=69108076&bitrate=747347&tag=dash_h264-basic-gen2_720p", player3:"" } },
            { id:"ksb-t1-c05-06", title:"Cap√≠tulo 05 y 06", info:"BD RPmods ‚Äî 1080p", players:{ player1:"https://rodrigorpmods.rpmlive.online/#qyx9cu", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/konosuba-temporada-1-cap%C3%ADtulo-5-cap%C3%ADtulo-6-latino-fanedit-especial-de-los-capitu/1079138534159539/", fb720:"https://video-bog2-2.xx.fbcdn.net/o1/v/t2/f2/m366/AQPYtTOSIL0h-YmwxZ4_bBgM1hmQoRwtFFFma94RkjQ3fWsdcOxmwvP6Cs3dVVifQ37Prjc_3DEpOwgeIboskkHqgcgIwzkx5muiURx8-nZT7A.mp4?_nc_cat=111&_nc_sid=5e9851&_nc_ht=video-bog2-2.xx.fbcdn.net&_nc_ohc=5g87jsq5sMcQ7kNvwGCYy8J&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjoxNTA4MzA1MzAzNzc0MjkxLCJhc3NldF9hZ2VfZGF5cyI6MCwidmlfdXNlY2FzZV9pZCI6MTAxMjIsImR1cmF0aW9uX3MiOjI2MzgsInVybGdlbl9zb3VyY2UiOiJ3d3cifQ%3D%3D&ccb=17-1&vs=d3683a711b2e720&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC8wQjQ1NDNDNkFEN0MwQTFEQTI3RTZBNkMwNERBQkM4N19tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhFZmJfZXBoZW1lcmFsLzY1NEZENjMyQzQ2MTgxNDJDMkVBMEFFOUM5OUUwRTgxX210XzBfYXVkaW9fZGFzaGluaXQubXA0FQICyAESACgAGAAbAogHdXNlX29pbAExEnByb2dyZXNzaXZlX3JlY2lwZQExFQAAJqaRwZ328q0FFQIoAkMzLBdApJ1Gp--dshgZZGFzaF9oMjY0LWJhc2ljLWdlbjJfNzIwcBEAdQJllJ4BAA&_nc_gid=8dKEO1iNvbkgdQRDOEbTlA&_nc_zt=28&oh=00_AfiXU38rGBtHdmJr87dweAl5JEL9xNrFl6g76eAMmygSuQ&oe=6911E545&bitrate=861915&tag=dash_h264-basic-gen2_720p", player3:"" } },
			{ id:"ksb-t1-c07-08", title:"Cap√≠tulo 07 y 08", info:"BD RPmods ‚Äî 1080p", players:{ player1:"https://rodrigorpmods.rpmlive.online/#gwdze9", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/konosuba-temporada-1-cap%C3%ADtulo-7-cap%C3%ADtulo-8-latino-fanedit-especial-de-los-capitu/2713887065610874/", fb720:"https://video-bog2-1.xx.fbcdn.net/o1/v/t2/f2/m366/AQMhldgHnsc3CDtzr_laes_EFFL4mQY8lu4nB0Wi8YDaOYgYz0KZEvrcEph5MaK12TZVg7z7ajo6lEYlkvr5MWyzFJ-A08yVccWvVdzBw-jfNw.mp4?_nc_cat=104&_nc_sid=5e9851&_nc_ht=video-bog2-1.xx.fbcdn.net&_nc_ohc=12bVMPJGdsAQ7kNvwFHcCsy&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjoxMTg2OTYxODcwMDExNjcyLCJhc3NldF9hZ2VfZGF5cyI6MCwidmlfdXNlY2FzZV9pZCI6MTAxMjIsImR1cmF0aW9uX3MiOjI2NDAsInVybGdlbl9zb3VyY2UiOiJ3d3cifQ%3D%3D&ccb=17-1&vs=cf7b046b8d8dd7ce&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC9BOTQ3MzhBQTUwNEQ2NzYxNzkyMzNFMEM0NjUzMTE4MV9tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhAZmJfcGVybWFuZW50LzFGNDYzQzkxOTRCMDdGRDMzNTZGRkFEQzIzMzNFRDlCX2F1ZGlvX2Rhc2hpbml0Lm1wNBUCAsgBEgAoABgAGwKIB3VzZV9vaWwBMRJwcm9ncmVzc2l2ZV9yZWNpcGUBMRUAACaw9P2Jo-KbBBUCKAJDMywXQKSgR64UeuEYGWRhc2hfaDI2NC1iYXNpYy1nZW4yXzcyMHARAHUCZZSeAQA&_nc_gid=2ZlTL6DiX1-TeN7_CpeKrQ&_nc_zt=28&oh=00_Afjz4G-kIKdSBmy7cobkBSIcq6eSyELm-PEkXUh_y1n9TA&oe=69147B8C&bitrate=637627&tag=dash_h264-basic-gen2_720p", player3:"" } },
			{ id:"ksb-t1-c09-10-11", title:"Cap√≠tulo 09 - 10 y 11 (OVA) FINAL", info:"BD RPmods ‚Äî 1080p", players:{ player1:"https://rodrigorpmods.rpmlive.online/#xuakg9", player2:"", fb:"https://www.facebook.com/rodrigorpmodsfanedits/videos/konosuba-temporada-1-cap%C3%ADtulo-9-cap%C3%ADtulo-10-capitulo-11-ova-t1-latino-fanedit-es/1330682754859694/", fb720:"https://video-bog2-1.xx.fbcdn.net/o1/v/t2/f2/m366/AQMPzo2RPpj6tC92IyLbKaAhPjayi1uu1z9xh98oDQpT4yJiOH1P6rYe4qlLREZAFEZV_BwWkVPTJ9J4kXEVrlCya8cR99K6HTNrL8gMejjLkw.mp4?_nc_cat=102&_nc_sid=5e9851&_nc_ht=video-bog2-1.xx.fbcdn.net&_nc_ohc=yvdEPgs-9mcQ7kNvwEhi9Dx&efg=eyJ2ZW5jb2RlX3RhZyI6Inhwdl9wcm9ncmVzc2l2ZS5GQUNFQk9PSy4uQzMuMTI4MC5kYXNoX2gyNjQtYmFzaWMtZ2VuMl83MjBwIiwieHB2X2Fzc2V0X2lkIjoxMzM4Njk4ODY3NTEyNTE2LCJhc3NldF9hZ2VfZGF5cyI6MCwidmlfdXNlY2FzZV9pZCI6MTAxMjIsImR1cmF0aW9uX3MiOjM5NjksInVybGdlbl9zb3VyY2UiOiJ3d3cifQ%3D%3D&ccb=17-1&vs=2fa9c1c166237a93&_nc_vs=HBksFQIYRWZiX2VwaGVtZXJhbC9DMDQxMzZBQzY1ODYyNTAyMzFBNUYwMzMyMzU3ODdBMl9tdF8xX3ZpZGVvX2Rhc2hpbml0Lm1wNBUAAsgBEgAVAhhAZmJfcGVybWFuZW50LzFENDFBRDBGNDRBMkY2MEFFNDVCNEIyQTU5QTkzODgzX2F1ZGlvX2Rhc2hpbml0Lm1wNBUCAsgBEgAoABgAGwKIB3VzZV9vaWwBMRJwcm9ncmVzc2l2ZV9yZWNpcGUBMRUAACaI06znw-LgBBUCKAJDMywXQK8CGp--dskYGWRhc2hfaDI2NC1iYXNpYy1nZW4yXzcyMHARAHUCZZSeAQA&_nc_gid=bgA_sFuIxYnwC-aQc_kTyA&_nc_zt=28&oh=00_Afg0XRKJnS8AjZGJBzivrW9Eb5WzB0OQbsPwXUiHj60HZg&oe=69159496&bitrate=673194&tag=dash_h264-basic-gen2_720p", player3:"" } }
          ],
          extrasAudio: { title: "Radio KonoSuba ‚Äî Selecci√≥n", url: "" },
          extras: [
            { id:"ksb-extra-1", title:"Konosuba Opening (JAPON√âS) (Crunchyroll)", url:"https://www.youtube.com/watch?v=fpG3BPNQepY" },
            { id:"ksb-extra-2", title:"Konosuba Ending (JAPON√âS) (Crunchyroll)", url:"https://www.youtube.com/watch?v=JhiU4IAZtug" },
          ],
          extrasPlaylist: {
            cover: "extra/CB_COVER.png",
            title: "Chiisana Boukensha ‚Äî Colecci√≥n Ending S1 (Japon√©s)",
            tracks: [
              { src: "extra/01CB.mp3",   title: "Chiisana Boukensha Ending Version Full" },
              { src: "extra/02CBAV.mp3", title: "Chiisana Boukensha Aqua Version Full" },
              { src: "extra/03CBM.mp3",  title: "Chiisana Boukensha Megumin Version Full" },
              { src: "extra/04CBD.mp3",  title: "Chiisana Boukensha Darkness Version Full" },
              { src: "extra/05CBI.mp3",  title: "Chiisana Boukensha (Instrumental)" }
            ]
          }
        },
        "KonoSuba (Temporada 2)": {
          cover: "",
          season2Key: null,
          openingUrl: "",
          endingUrl: "",
          info: {
            audio: "Japon√©s",
            subs: "Espa√±ol (SUB)",
            oped: "Clean Version",
            karaoke: "S√≠",
            quality: "1080p (BD RPmods)",
            note: "Temporada 2 con mejoras BD RPmods."
          },
          chapters: [
            { id:"ksb-t2-prox0", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 01 y 02", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
            { id:"ksb-t2-prox1", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 03 y 04", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
            { id:"ksb-t2-prox2", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 05 y 06", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } }
          ],
          extrasAudio: { title: "Radio KonoSuba T2 ‚Äî Selecci√≥n", url: "" },
          extras: [
            { id:"ksb2-extra-1", title:"Extra 01 ‚Äî PV T2", url:"" },
            { id:"ksb2-extra-2", title:"Extra 02 ‚Äî Clean OP (BD)", url:"" },
            { id:"ksb2-extra-3", title:"Extra 03 ‚Äî Clean ED (BD)", url:"" }
          ],
          extrasPlaylist: { cover:"extra/cover_konosuba_t2.jpg", title:"Playlist ‚Äî KonoSuba T2", tracks: [] }
        }
      },
      tv: {
        "Las 100 Novias": {
          cover: "",
          season2Key: null,
          info: {
            audio: "Japon√©s",
            subs: "Espa√±ol (SUB)",
            oped: "Versi√≥n TV",
            karaoke: "No",
            quality: "1080p",
            note: "Edici√≥n est√°ndar para streaming."
          },
          chapters: [
            { id:"100nv-prox0", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 01 y 02", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
            { id:"100nv-prox1", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 03 y 04", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } },
            { id:"100nv-prox2", title:"Pr√≥ximamente ‚Äî Cap√≠tulos 05 y 06", info:"Esperando estreno", status:"Pr√≥ximo", players:{ player1:"", player2:"", fb:"", fb720:"", player3:"" } }
          ],
          extrasAudio: { title: "OST ‚Äî 100 Novias", url: "" },
          extras: [
            { id:"100nv-extra-1", title:"Extra 01 ‚Äî PV #1", url:"" },
            { id:"100nv-extra-2", title:"Extra 02 ‚Äî PV #2", url:"" },
            { id:"100nv-extra-3", title:"Extra 03 ‚Äî OST Preview", url:"" }
          ],
          extrasPlaylist: { cover:"extra/cover_100novias.jpg", title:"Playlist ‚Äî 100 Novias", tracks: [] }
        }
      }
    };

    /* ===========================
       UTILIDADES UI
       =========================== */
    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    /* ===========================
       COUNTAPI (likes + visitas)
       =========================== */
    const COUNTAPI_BASE = 'https://api.countapi.xyz';
    const COUNTAPI_NS   = 'rodrigorpmods'; // namespace global

    function slugifySeries(scope, key){
      let base = (key || '').toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[()]/g, '')
        .replace(/[^a-z0-9]+/g, '_')
        .replace(/^_+|_+$/g, '');
      return `${scope}_${base}`;
    }
    async function countapi(path){
      const res = await fetch(`${COUNTAPI_BASE}${path}`);
      if(!res.ok) throw new Error(`CountAPI ${res.status}`);
      return res.json();
    }
    async function ensureKey(type, slug){
      const key = `${type}:${slug}`;
      try {
        const r = await countapi(`/get/${COUNTAPI_NS}/${key}`);
        if(typeof r.value === 'number') return r.value;
      } catch(e) {}
      const r2 = await countapi(`/create?namespace=${encodeURIComponent(COUNTAPI_NS)}&key=${encodeURIComponent(key)}&value=0`);
      return r2.value ?? 0;
    }
    async function hitView(slug){
      const key = `views:${slug}`;
      const r = await countapi(`/hit/${COUNTAPI_NS}/${key}`);
      return r.value;
    }
    async function getLikes(slug){
      await ensureKey('likes', slug);
      const r = await countapi(`/get/${COUNTAPI_NS}/likes:${slug}`);
      return r.value || 0;
    }
    async function addLike(slug){
      const r = await countapi(`/update/${COUNTAPI_NS}/likes:${slug}?amount=1`);
      return r.value;
    }
    function localLikeKey(slug){ return `rp_like_${slug}`; }
    function hasLiked(slug){ return localStorage.getItem(localLikeKey(slug)) === '1'; }
    function markLiked(slug){ localStorage.setItem(localLikeKey(slug), '1'); }

    const tabButtons = $$('.tab');
    const tabAnimes  = $('#tab-animes');
    const tabJuegos  = $('#tab-juegos');

    tabButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        tabButtons.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.dataset.tab;
        if(id==='animes'){ tabAnimes.style.display='grid'; tabJuegos.style.display='none'; }
        else { tabAnimes.style.display='none'; tabJuegos.style.display='grid'; }
      });
    });

    // Estado
    let currentScope = 'bd';
    let currentAnimeKey = null;
    let currentChapterId = null;

    // Elementos din√°micos
    const listBD = $('#list-bd');
    const listTV = $('#list-tv');
    const searchAll = $('#search-all');

    const crumbs = $('#breadcrumbs');
    const badges = $('#badges');
    const categoryNote = $('#category-note');

    const chaptersTitle = $('#chapters-title');
    const chaptersList = $('#chapters-list');
    const playerButtonsWrap = $('#player-buttons');
    const viewer = $('#viewer');
    // Contadores (UI)
    const viewsCount = $('#views-count');
    const likesCount = $('#likes-count');
    const likeBtn    = $('#like-btn');
    const likeHint   = $('#like-hint');
    const extrasGrid = document.querySelector('#extras-grid');

    // Audio √∫nico (opcional)
    const audioBox = $('#audio-box');
    const audioTitle = $('#audio-title');
    const audioPlayer = $('#audio-player');
    const audioSrc = $('#audio-src');

    // Playlist UI
    const playlistBox = $('#playlist-box');
    const playlistCover = $('#playlist-cover');
    const playlistTitle = $('#playlist-title');
    const trackList = $('#track-list');
    const btnPrev = $('#btn-prev');
    const btnPlay = $('#btn-play');
    const btnNext = $('#btn-next');
    const playlistAudio = $('#playlist-audio');

    /* Render Sidebar con filtro unificado */
    function renderSidebar(filter = ""){
      listBD.innerHTML = '';
      listTV.innerHTML = '';

      Object.keys(DATA.bd)
        .filter(k => k.toLowerCase().includes(filter.toLowerCase()))
        .forEach(key => listBD.appendChild(createSideItem('bd', key, 'BD RPmods')));

      Object.keys(DATA.tv)
        .filter(k => k.toLowerCase().includes(filter.toLowerCase()))
        .forEach(key => listTV.appendChild(createSideItem('tv', key, 'Anime')));

      const active = $(`.side-item[data-scope="${currentScope}"][data-key="${CSS.escape(currentAnimeKey||'')}"]`);
      if(active) active.classList.add('active');
    }

    function createSideItem(scope, key, catLabel){
      const item = document.createElement('div');
      item.className = 'side-item';
      item.dataset.scope = scope;
      item.dataset.key = key;

      const cover = (DATA[scope][key].cover || "").trim();

      item.innerHTML = `
        <div class="side-thumb" style="${cover ? `background-image:url('${cover}')` : ''}"></div>
        <div class="side-info">
          <div class="side-title">${key}</div>
          <div class="side-sub">${catLabel}</div>
        </div>
      `;
      item.addEventListener('click', ()=>{
        $$('.side-item').forEach(i=>i.classList.remove('active'));
        item.classList.add('active');
        selectSeries(scope, key);
      });
      return item;
    }

    // === Contadores por serie ===
    async function updateCounters(scope, key){
      const slug = slugifySeries(scope, key);

      // VISITAS
      try {
        const v = await hitView(slug);
        viewsCount.textContent = v;
      } catch(e){
        viewsCount.textContent = '‚Äî';
      }

      // LIKES
      likeHint.textContent = '';
      likeBtn.disabled = false;
      likeBtn.classList.remove('disabled');
      likeBtn.onclick = null; // limpia handlers anteriores

      try {
        const currentLikes = await getLikes(slug);
        likesCount.textContent = currentLikes;

        if(hasLiked(slug)){
          likeBtn.disabled = true;
          likeBtn.classList.add('disabled');
          likeHint.textContent = 'Ya diste like a esta serie en este dispositivo.';
        } else {
          likeBtn.onclick = async ()=>{
            if(likeBtn.disabled) return;
            likeBtn.disabled = true;
            try {
              const newVal = await addLike(slug);
              likesCount.textContent = newVal;
              markLiked(slug);
              likeHint.textContent = '¬°Gracias por tu like!';
              likeBtn.classList.add('disabled');
            } catch(e){
              likeBtn.disabled = false;
              likeHint.textContent = 'Error al dar like. Intenta de nuevo.';
            }
          };
        }
      } catch(e){
        likesCount.textContent = '‚Äî';
        likeHint.textContent = 'No se pudo cargar likes.';
      }
    }

    function selectSeries(scope, key){
      currentScope = scope;
      currentAnimeKey = key;
      currentChapterId = null;

      const info = DATA[scope][key].info;

      setCrumbs(scope, key);
      setBadges(info);
      setChapters(scope, key);
      setExtras(scope, key);
      setCategoryText(scope, key);
      resetViewer(); // portada placeholder

      // NUEVO: actualizar likes/visitas por serie
      updateCounters(scope, key);
    }

    /* Texto por categor√≠a y bot√≥n "Ir a Temporada 2" en BD RPmods */
    function setCategoryText(scope, key){
      const series = DATA[scope][key];
      const baseText = scope==='bd'
        ? `<strong>Anime BD RPmods:</strong> versiones Blu-ray mejoradas con a√±adidos especiales.`
        : `<strong>Anime:</strong> ediciones est√°ndar para streaming.`;

      const hasT2 = (scope === 'bd') && series && series.season2Key && !!DATA.bd[series.season2Key];
      const seasonLink = hasT2 ? ` <span id="season-jump" class="link-season">Ir a Temporada 2 ‚§¥</span>` : '';

      categoryNote.innerHTML = baseText + seasonLink;

      if(hasT2){
        const jump = document.getElementById('season-jump');
        jump.onclick = ()=>{
          const t2Key = series.season2Key;
          const target = document.querySelector(`.side-item[data-scope="bd"][data-key="${CSS.escape(t2Key)}"]`);
          if(target) target.click(); else selectSeries('bd', t2Key);
        };
      }
    }

    function setCrumbs(scope, key){
      const scopeTxt = scope==='bd' ? 'Anime BD RPmods' : 'Anime';
      crumbs.textContent = `${scopeTxt} / ${key}`;
    }

    function setBadges(info){
      badges.innerHTML = '';
      const mk = (txt, primary=false)=>{
        const s = document.createElement('span');
        s.className = 'badge' + (primary?' primary':'');
        s.textContent = txt; return s;
      };
      badges.appendChild(mk(`Audio: ${info.audio || '‚Äî'}`));
      badges.appendChild(mk(`Subt√≠tulos: ${info.subs || '‚Äî'}`));
      badges.appendChild(mk(`OP/ED: ${info.oped || '‚Äî'}`));
      badges.appendChild(mk(`Karaoke: ${info.karaoke || '‚Äî'}`));
      badges.appendChild(mk(`Calidad: ${info.quality || '‚Äî'}`, true));
    }

    function setChapters(scope, key){
      const series = DATA[scope][key];
      chaptersTitle.textContent = `Cap√≠tulos ‚Äî ${key}`;
      chaptersList.innerHTML = '';
      series.chapters.forEach((ch, idx)=>{
        const row = document.createElement('div');
        row.className = 'chap-item';
        row.dataset.id = ch.id;
        row.innerHTML = `
          <div>
            <div><strong>${ch.title}</strong></div>
            <div class="small" style="opacity:.8">${ch.info || ''}</div>
          </div>
          <span class="tag">${ch.status ? ch.status : 'Disponible'}</span>
        `;
        row.addEventListener('click', ()=>{
          $$('.chap-item').forEach(i=>i.classList.remove('active'));
          row.classList.add('active');
          currentChapterId = ch.id;
          renderPlayerButtons(ch.players);
          resetViewer(true);
        });
        chaptersList.appendChild(row);
      });
    }

    function renderPlayerButtons(players){
      playerButtonsWrap.innerHTML = '';
      const defs = [
        { key:'player1', label:'Reproductor 1' },
        { key:'player2', label:'Reproductor 2' },
        { key:'fb',     label:'Ver en Facebook' },
        { key:'fb720',  label:'Reproductor Facebook 720p' },
        { key:'player3',label:'Reproductor 3' },
      ];

      defs.forEach(def=>{
        const url = (players && players[def.key]) ? players[def.key] : '';
        const btn = document.createElement('button');
        btn.className = 'btn ' + (url ? 'primary' : 'disabled');
        if(!url) btn.setAttribute('disabled','');
        btn.textContent = url ? def.label : `${def.label} (sin link)`;
        btn.dataset.url = url || '';
        btn.addEventListener('click', (e)=>{
          const u = e.currentTarget.dataset.url;
          if(!u) return;
          // Solo "Ver en Facebook" abre nueva pesta√±a
          if(def.key === 'fb'){
            window.open(u, '_blank');
          }else{
            openInViewer(u);
          }
        });
        playerButtonsWrap.appendChild(btn);
      });
    }

    /* ====== EXTRAS ====== */
    function setExtras(scope, key){
      const series = DATA[scope][key];

      // Audio √∫nico
      if(series.extrasAudio && series.extrasAudio.url){
        audioBox.style.display = 'flex';
        audioTitle.textContent = series.extrasAudio.title || 'Banda sonora';
        audioSrc.src = series.extrasAudio.url;
        audioPlayer.load();
      }else{
        audioBox.style.display = 'none';
        audioSrc.src = '';
        audioPlayer.pause();
      }

      // Playlist:
      const pl = series.extrasPlaylist;
      const isBD = (scope === 'bd');

      if(isBD){
        renderPlaylist(`${scope}|${key}`, pl || { cover:'', title:'Playlist', tracks: [] }, { forceShow:true });
      }else{
        if(pl && Array.isArray(pl.tracks) && pl.tracks.length){
          renderPlaylist(`${scope}|${key}`, pl, { forceShow:false });
        }else{
          playlistBox.style.display = 'none';
          trackList.innerHTML = '';
          playlistAudio.pause();
        }
      }

      // Tarjetas extra (todas en NUEVA pesta√±a)
      extrasGrid.innerHTML = '';

      let extrasToRender = [];

      if(isBD){
        // Opening/Ending por serie
        extrasToRender.push(
          { id:"opening", title:"Opening Clean Version", url: series.openingUrl || "" },
          { id:"ending",  title:"Ending Clean Version",  url: series.endingUrl  || "" },
        );
      }

      // + extras propios
      (series.extras || []).forEach(ex => extrasToRender.push(ex));

      extrasToRender.forEach((ex)=>{
        const card = document.createElement('div');
        card.className = 'extra-card';
        const hasUrl = !!(ex.url && ex.url.trim());
        card.innerHTML = `
          <div class="title">${ex.title}</div>
          <div class="mini">Material exclusivo o adicional.</div>
          <button class="btn ${!hasUrl ? 'disabled' : 'primary'}" ${!hasUrl ? 'disabled':''}
                  data-url="${hasUrl ? ex.url : ''}">
            ${hasUrl ? 'Abrir en nueva pesta√±a' : 'Sin enlace'}
          </button>
        `;
        card.querySelector('button').addEventListener('click', (e)=>{
          const url = e.currentTarget.dataset.url;
          if(!url) return;
          window.open(url, '_blank');
        });
        extrasGrid.appendChild(card);
      });
    }

    function renderPlaylist(stateKey, pl, opts = { forceShow:false }){
      playlistBox.style.display = 'grid';
      playlistTitle.textContent = pl.title || 'Playlist';
      playlistCover.style.backgroundImage =
        (pl.cover && pl.cover.trim()) ? `url('${pl.cover}')` : 'linear-gradient(135deg, #1d1d1d, #0f0f0f)';

      if(!renderPlaylist.state) renderPlaylist.state = {};
      if(!renderPlaylist.state[stateKey]) renderPlaylist.state[stateKey] = { index:0, playing:false };
      const state = renderPlaylist.state[stateKey];

      const tracks = Array.isArray(pl.tracks) ? pl.tracks : [];
      trackList.innerHTML = '';

      if(tracks.length === 0){
        const empty = document.createElement('div');
        empty.className = 'track-item';
        empty.innerHTML = `<div>Sin pistas por ahora</div><span class="tag">Pr√≥ximamente</span>`;
        trackList.appendChild(empty);
        btnPrev.disabled = true; btnNext.disabled = true;
        btnPrev.classList.add('disabled'); btnNext.classList.add('disabled');
        btnPlay.textContent = '‚ñ∂ Reproducir';
        btnPlay.onclick = ()=>{};
        playlistAudio.pause();
        playlistAudio.removeAttribute('src');
        return;
      }

      btnPrev.disabled = false; btnNext.disabled = false;
      btnPrev.classList.remove('disabled'); btnNext.classList.remove('disabled');

      tracks.forEach((t, i)=>{
        const li = document.createElement('div');
        li.className = 'track-item' + (i===state.index && state.playing ? ' active' : '');
        li.dataset.index = i;
        li.innerHTML = `<div>${t.title || ('Pista '+(i+1))}</div><span class="tag">${i===state.index && state.playing ? 'En curso' : 'Reproducir'}</span>`;
        li.addEventListener('click', ()=>{
          state.index = i; state.playing = true;
          loadAndPlay({ tracks }, state);
          refreshTrackList({ tracks }, state);
        });
        trackList.appendChild(li);
      });

      btnPrev.onclick = ()=>{
        state.index = (state.index - 1 + tracks.length) % tracks.length;
        state.playing = true;
        loadAndPlay({ tracks }, state);
        refreshTrackList({ tracks }, state);
      };
      btnNext.onclick = ()=>{
        state.index = (state.index + 1) % tracks.length;
        state.playing = true;
        loadAndPlay({ tracks }, state);
        refreshTrackList({ tracks }, state);
      };
      btnPlay.onclick = ()=>{
        if(state.playing){
          playlistAudio.pause(); state.playing = false; btnPlay.textContent = '‚ñ∂ Reproducir';
        }else{
          if(!playlistAudio.src) loadAndPlay({ tracks }, state); else playlistAudio.play();
          state.playing = true; btnPlay.textContent = '‚è∏ Pausar';
        }
        refreshTrackList({ tracks }, state);
      };

      playlistAudio.onended = ()=>{
        state.index = (state.index + 1) % tracks.length;
        state.playing = true;
        loadAndPlay({ tracks }, state);
        refreshTrackList({ tracks }, state);
      };

      if(!playlistAudio.src && tracks.length){
        loadTrack({ tracks }, state);
        btnPlay.textContent = '‚ñ∂ Reproducir';
      }
      refreshTrackList({ tracks }, state);
    }

    function loadTrack(pl, state){
      const track = pl.tracks[state.index];
      playlistAudio.src = track.src || '';
    }
    function loadAndPlay(pl, state){
      loadTrack(pl, state);
      playlistAudio.play().catch(()=>{ /* autoplay bloqueado */ });
      btnPlay.textContent = '‚è∏ Pausar';
    }
    function refreshTrackList(pl, state){
      $$('#track-list .track-item').forEach((el, i)=>{
        const active = (i===state.index && state.playing);
        el.classList.toggle('active', active);
        const tag = el.querySelector('.tag');
        if(tag) tag.textContent = active ? 'En curso' : 'Reproducir';
      });
    }

    /* ========= Visor ========= */
    function resetViewer(showHint=false){
      const cover = (DATA[currentScope][currentAnimeKey]?.cover || "").trim();
      viewer.innerHTML = '';
      if(cover){
        const ph = document.createElement('div');
        ph.className = 'cover-ph';
        ph.style.backgroundImage = `url('${cover}')`;
        viewer.appendChild(ph);
      }
      const hint = document.createElement('div');
      hint.className = 'cover-hint';
      hint.textContent = showHint ? 'Elige un reproductor para cargar el video aqu√≠' : 'Selecciona un cap√≠tulo y un reproductor';
      viewer.appendChild(hint);
    }

    function openInViewer(url){
      if(!url) return;
      viewer.innerHTML = `<iframe allow="autoplay; fullscreen" src="${url}"></iframe>`;
    }

    // Filtro unificado
    searchAll.addEventListener('input', ()=> renderSidebar(searchAll.value));

    // Inicializaci√≥n
    renderSidebar();
    const firstBD = listBD.querySelector('.side-item');
    if(firstBD){ firstBD.click(); }
  </script>
</body>

</html>





